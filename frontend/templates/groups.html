<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—Ä—É–ø–ø—ã</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% include '_sidebar.html' %}

    <div class="main-content">
        <div class="page-header" style="display: flex; align-items: center; gap: 10px;">
            <h1 style="flex:1;">üë®‚Äçüë©‚Äçüë¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏</h1>
            <button class="btn-success" onclick="showAddGroupModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É</button>
        </div>
        
        <table class="data-table" id="groupsTable" style="margin-top: 20px;">
            <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–î–Ω–∏</th>
                    <th>–í—Ä–µ–º—è –∑–∞–Ω—è—Ç–∏—è</th>
                    <th>–û–ø–æ–∑–¥–∞–Ω–∏–µ (–º–∏–Ω)</th>
                    <th>–£—á–µ–Ω–∏–∫–æ–≤</th>
                    <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="groupsTableBody">
                <tr><td colspan="6">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
            </tbody>
        </table>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã -->
    <div id="addGroupModal" class="modal">
        <div class="modal-content modern-modal">
            <div class="modal-header-fixed">
                <h2>–î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É</h2>
                <div class="modal-header-actions">
                    <button type="button" onclick="closeAddGroupModal()" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" form="addGroupForm" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
            <div class="modal-body-scrollable">
            <form id="addGroupForm" class="modal-form">
                    <div class="form-card">
                        <label class="field-label" for="groupName">–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</label>
                        <input type="text" id="groupName" required placeholder="–ì—Ä—É–ø–ø–∞ 1, –ú–ª–∞–¥—à–∞—è...">
                    </div>

                    <div class="form-card">
                        <label class="field-label" for="durationMinutes">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–Ω—è—Ç–∏—è</label>
                        <div style="position: relative; width: 100%;">
                            <select id="durationMinutes" required style="width: 100%; padding: 12px 40px 12px 16px; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 0.95rem; background: #fff; appearance: none; -webkit-appearance: none; -moz-appearance: none; cursor: pointer; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                                <option value="30">30 –º–∏–Ω—É—Ç</option>
                                <option value="60" selected>1 —á–∞—Å</option>
                                <option value="90">1 —á–∞—Å 30 –º–∏–Ω—É—Ç</option>
                                <option value="120">2 —á–∞—Å–∞</option>
                                <option value="150">2 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç</option>
                                <option value="180">3 —á–∞—Å–∞</option>
                                <option value="210">3 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç</option>
                                <option value="240">4 —á–∞—Å–∞</option>
                                <option value="270">4 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç</option>
                            </select>
                            <div style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); pointer-events: none; width: 20px; height: 20px;">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </div>
                        </div>
                        <small class="field-hint">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª–∏—Ç—Å—è –æ–¥–Ω–æ –∑–∞–Ω—è—Ç–∏–µ</small>
                    </div>

                    <!-- –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–Ω–µ–π –∏ –≤—Ä–µ–º–µ–Ω–∏ -->
                    <div class="form-card">
                        <label class="field-label">üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–Ω–∏ –∏ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–∏–π</label>
                        <small class="field-hint">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–±–æ–¥–Ω—ã–µ –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–Ω—è—Ç—ã–µ —è—á–µ–π–∫–∏. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤—Å–µ—Ö –¥–Ω–µ–π –≥—Ä—É–ø–ø—ã.</small>
                        <div id="selectedSlotsDisplay" class="selected-slots-display" style="margin-bottom: 12px;"></div>
                        <div id="scheduleVisualization" class="schedule-visualization">
                            <div class="schedule-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>
                        </div>
                        <input type="hidden" id="scheduleTime" required>
                        <input type="hidden" id="scheduleDays" required>
                    </div>

                    <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –±–ª–æ–∫–æ–≤ —Å—Ç–∞–¥–∏–æ–Ω–∞ -->
                    <div class="form-card">
                        <label class="field-label">üèüÔ∏è –†–∞–∑–º–µ—Ä –≥—Ä—É–ø–ø—ã –Ω–∞ –ø–æ–ª–µ</label>
                        <small class="field-hint">–í—ã–±–µ—Ä–∏—Ç–µ, —Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤ —Å—Ç–∞–¥–∏–æ–Ω–∞ –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å —ç—Ç–∞ –≥—Ä—É–ø–ø–∞. –ö–ª–∏–∫–∞–π—Ç–µ –Ω–∞ —Å–æ—Å–µ–¥–Ω–∏–µ –±–ª–æ–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö.</small>
                        <div id="fieldBlocksVisualization" class="field-blocks-container">
                            <div class="field-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º—ã –ø–æ–ª—è...</div>
                        </div>
                        <div id="fieldBlocksInfo" class="field-blocks-info" style="margin-top: 12px; display: none;">
                            <span class="field-info-label">–í—ã–±—Ä–∞–Ω–æ –±–ª–æ–∫–æ–≤:</span>
                            <span id="selectedBlocksCount" class="field-info-value">0</span>
                            <span class="field-info-separator">/</span>
                            <span id="availableBlocksCount" class="field-info-value">0</span>
                        </div>
                        <input type="hidden" id="fieldBlocks" required>
                    </div>

                    <div class="form-card two-col">
                        <div>
                            <label class="field-label" for="lateThreshold">–ü–æ—Ä–æ–≥ –æ–ø–æ–∑–¥–∞–Ω–∏—è (–º–∏–Ω—É—Ç)</label>
                            <input type="number" id="lateThreshold" value="15" min="0" required>
                        </div>
                        <div>
                            <label class="field-label" for="maxStudents">–ú–∞–∫—Å. —É—á–µ–Ω–∏–∫–æ–≤</label>
                            <input type="number" id="maxStudents" placeholder="–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π" min="1">
                        </div>
                    </div>

                    <div class="form-card">
                        <label class="field-label" for="notes">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea id="notes" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
                    </div>

                    <div id="slotValidationMessage" class="form-alert" style="display:none;"></div>
            </form>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã -->
    <div id="editGroupModal" class="modal">
        <div class="modal-content modern-modal">
            <div class="modal-header-fixed">
                <h2>–û–±–Ω–æ–≤–∏—Ç—å –≥—Ä—É–ø–ø—É</h2>
                <div class="modal-header-actions">
                    <button type="button" onclick="closeEditGroupModal()" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" form="editGroupForm" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
            <div class="modal-body-scrollable">
            <form id="editGroupForm" class="modal-form">
                    <input type="hidden" id="editGroupId">

                    <div class="form-card">
                        <label class="field-label" for="editGroupName">–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</label>
                        <input type="text" id="editGroupName" required>
                    </div>

                    <div class="form-card">
                        <label class="field-label" for="editDurationMinutes">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–Ω—è—Ç–∏—è</label>
                        <div style="position: relative; width: 100%;">
                            <select id="editDurationMinutes" required style="width: 100%; padding: 12px 40px 12px 16px; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 0.95rem; background: #fff; appearance: none; -webkit-appearance: none; -moz-appearance: none; cursor: pointer; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                                <option value="30">30 –º–∏–Ω—É—Ç</option>
                                <option value="60">1 —á–∞—Å</option>
                                <option value="90">1 —á–∞—Å 30 –º–∏–Ω—É—Ç</option>
                                <option value="120">2 —á–∞—Å–∞</option>
                                <option value="150">2 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç</option>
                                <option value="180">3 —á–∞—Å–∞</option>
                                <option value="210">3 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç</option>
                                <option value="240">4 —á–∞—Å–∞</option>
                                <option value="270">4 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç</option>
                            </select>
                            <div style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); pointer-events: none; width: 20px; height: 20px;">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#475569" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </div>
                        </div>
                        <small class="field-hint">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª–∏—Ç—Å—è –æ–¥–Ω–æ –∑–∞–Ω—è—Ç–∏–µ</small>
                    </div>

                    <!-- –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–Ω–µ–π –∏ –≤—Ä–µ–º–µ–Ω–∏ -->
                    <div class="form-card">
                        <label class="field-label">üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–Ω–∏ –∏ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–∏–π</label>
                        <small class="field-hint">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–±–æ–¥–Ω—ã–µ –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–Ω—è—Ç—ã–µ —è—á–µ–π–∫–∏. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤—Å–µ—Ö –¥–Ω–µ–π –≥—Ä—É–ø–ø—ã.</small>
                        <div id="editSelectedSlotsDisplay" class="selected-slots-display" style="margin-bottom: 12px;"></div>
                        <div id="editScheduleVisualization" class="schedule-visualization">
                            <div class="schedule-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>
                        </div>
                        <input type="hidden" id="editScheduleTime" required>
                        <input type="hidden" id="editScheduleDays" required>
                    </div>

                    <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –±–ª–æ–∫–æ–≤ —Å—Ç–∞–¥–∏–æ–Ω–∞ -->
                    <div class="form-card">
                        <label class="field-label">üèüÔ∏è –†–∞–∑–º–µ—Ä –≥—Ä—É–ø–ø—ã –Ω–∞ –ø–æ–ª–µ</label>
                        <small class="field-hint">–í—ã–±–µ—Ä–∏—Ç–µ, —Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤ —Å—Ç–∞–¥–∏–æ–Ω–∞ –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å —ç—Ç–∞ –≥—Ä—É–ø–ø–∞. –ö–ª–∏–∫–∞–π—Ç–µ –Ω–∞ —Å–æ—Å–µ–¥–Ω–∏–µ –±–ª–æ–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö.</small>
                        <div id="editFieldBlocksVisualization" class="field-blocks-container">
                            <div class="field-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º—ã –ø–æ–ª—è...</div>
                        </div>
                        <div id="editFieldBlocksInfo" class="field-blocks-info" style="margin-top: 12px; display: none;">
                            <span class="field-info-label">–í—ã–±—Ä–∞–Ω–æ –±–ª–æ–∫–æ–≤:</span>
                            <span id="editSelectedBlocksCount" class="field-info-value">0</span>
                            <span class="field-info-separator">/</span>
                            <span id="editAvailableBlocksCount" class="field-info-value">0</span>
                        </div>
                        <input type="hidden" id="editFieldBlocks" required>
                    </div>

                    <div class="form-card two-col">
                        <div>
                            <label class="field-label" for="editLateThreshold">–ü–æ—Ä–æ–≥ –æ–ø–æ–∑–¥–∞–Ω–∏—è (–º–∏–Ω—É—Ç)</label>
                            <input type="number" id="editLateThreshold" min="0" required>
                        </div>
                        <div>
                            <label class="field-label" for="editMaxStudents">–ú–∞–∫—Å. —É—á–µ–Ω–∏–∫–æ–≤</label>
                            <input type="number" id="editMaxStudents" placeholder="–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π" min="1">
                        </div>
                    </div>

                    <div class="form-card">
                        <label class="field-label" for="editNotes">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea id="editNotes" rows="3"></textarea>
                    </div>

                    <div id="editSlotValidationMessage" class="form-alert" style="display:none;"></div>
            </form>
            </div>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª—É–±–∞ -->
    <div id="clubSettingsModal" class="modal">
        <div class="modal-content modern-modal">
            <div class="modal-header-fixed">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª—É–±–∞</h2>
                <div class="modal-header-actions">
                    <button type="button" onclick="closeSettingsModal()" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" form="clubSettingsForm" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
            <div class="modal-body-scrollable">
            <form id="clubSettingsForm" class="modal-form">
                    <div class="form-card">
                        <label class="field-label">–†–∞–±–æ—á–∏–µ –¥–Ω–∏</label>
                        <div class="weekdays-grid" id="settingsWeekdaySelector">
                            {% for day,label in [(1,'–ü–Ω'),(2,'–í—Ç'),(3,'–°—Ä'),(4,'–ß—Ç'),(5,'–ü—Ç'),(6,'–°–±'),(7,'–í—Å')] %}
                            <label class="weekday-pill">
                                <input type="checkbox" class="weekday-checkbox" data-target="settings" value="{{ day }}">
                                <span>{{ label }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="form-card three-field">
                        <div>
                            <label class="field-label" for="workStartTime">–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã</label>
                            <input type="time" id="workStartTime" required>
                        </div>
                        <div>
                            <label class="field-label" for="workEndTime">–û–∫–æ–Ω—á–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã</label>
                            <input type="time" id="workEndTime" required>
                        </div>
                        <div>
                            <label class="field-label" for="maxGroupsPerSlot">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ–ª—è (–≥—Ä—É–ø–ø)</label>
                            <input type="number" id="maxGroupsPerSlot" min="1" required>
                        </div>
                    </div>

                    <div class="form-card" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:16px;">
                        <label style="display:flex;gap:12px;align-items:center;cursor:pointer;">
                            <div style="position:relative;width:22px;height:22px;">
                                <input type="checkbox" id="blockFuturePayments" style="position:absolute;opacity:0;width:22px;height:22px;cursor:pointer;z-index:2;">
                                <div id="blockFuturePaymentsBox" style="width:22px;height:22px;border:2px solid #3b82f6;border-radius:4px;background:#fff;display:flex;align-items:center;justify-content:center;transition:all 0.2s;">
                                    <svg id="blockFuturePaymentsCheck" style="display:none;width:14px;height:14px;fill:#fff;" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                                </div>
                            </div>
                            <span style="font-size:15px;font-weight:500;color:#1e293b;">–ù–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–ø–ª–∞—Ç—É –∑–∞ –±—É–¥—É—â–∏–µ –º–µ—Å—è—Ü—ã</span>
                        </label>
                        <small style="color:#64748b;display:block;margin-top:8px;margin-left:34px;">–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, –æ–ø–ª–∞—Ç—É –º–æ–∂–Ω–æ –≤–Ω–æ—Å–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞ —Ç–µ–∫—É—â–∏–π –∏ –ø—Ä–æ—à–µ–¥—à–∏–µ –º–µ—Å—è—Ü—ã.</small>
                    </div>
                    <script>
                        (function() {
                            const cb = document.getElementById('blockFuturePayments');
                            const box = document.getElementById('blockFuturePaymentsBox');
                            const check = document.getElementById('blockFuturePaymentsCheck');
                            function update() {
                                if (cb.checked) {
                                    box.style.background = '#3b82f6';
                                    box.style.borderColor = '#3b82f6';
                                    check.style.display = 'block';
                                } else {
                                    box.style.background = '#fff';
                                    box.style.borderColor = '#3b82f6';
                                    check.style.display = 'none';
                                }
                            }
                            cb.addEventListener('change', update);
                            // Observe for programmatic changes
                            new MutationObserver(update).observe(cb, {attributes: true, attributeFilter: ['checked']});
                            // Initial state
                            setTimeout(update, 100);
                        })();
                    </script>

                    <div id="settingsStatus" class="form-alert" style="display:none;"></div>
            </form>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/groups.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
</body>
</html>
